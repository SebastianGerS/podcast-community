# deleting notification, sockets and more

Today I have add func to delte notifications, on the front end side i'm not refetching the notifications becouse that would complicate things due to the pagination, so instead i'm just deleting it in the database and updateing the local redux state after deletion removing the corresponding notification from the state and also subtractiing one from the total (total number of notifications) and next_offset.
The reason we must do this is becouse we now have removed one notification from the database the next request for more notifications (triggerd by scrolling down the list) will have shifted up one step and we will skip one notification per deletion if we don't do this. Say for example that ther's 31 notifications in total, at the moment 20 are already feched and so the total is ofcorse at 30 and next_offset is set to 20. If we now delete notification number 11 then that will mean that in the next request to fetch tha last 10 notifications we will instead get 9 we wont get the 21:st notification becouse that one will have been shifted down to number 20 in the request to the database, therefor we must also subtract one from next_offset to get it to 19 to be able to fetch all notifications.

I also noticed that ther was a problem with user specific data being specific and after some swift research found a way to reset the redux stor when th user loggs out (by creating a rootreducer that returns all the redusers with undefined state).

I also started to look at sockets and created a basic setup by creating a helper function that recivece an userId and creates a socket with some listeners and the returns the socket (so that in can be set as a reference in the redux store and be referneced and then disconnected when the user loggsout) this function is called when the user loggs in, the plan in to utalize this socket to enable both emiting event when needed and listening for user specific emitions from the server for example when a new notification has been added.
I'm not certain yeat how I should go about fetching for instance new notifications my privious plan was to just get the latest notificaton for that user and then emit it to that user (if connected) but I'm not so sure that thats a good idé, if several users are creating events that trigger notifications for that users at the same time we might get a race condition in which some times the same notification will be emited several times and som might not be emited at all. I have no good idé on how to solve that at this moment but will continue thinking about it tomorrow.