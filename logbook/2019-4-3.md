# sockets, mongoose hooks and more

To day I have completed the flow with hooks in a way that seams error prof, insted of emiting an event from the client of the user that created that event on success, i'm emiting the event direct after the notification has been created from the server by passing the io to the controller and emiting from there.
I have also looked a bit at pre hooks for mongooes and i'm now using thoes hook to populated tha data i need for the notifications.
Also added a count of unobserved notifications to send to front end when fetching the users notifications, but i realized just a few minutes ago that I probably should send the total amouth of unobserved notifications not just the count of from the paginated results like i'm doing now, I will fix that tomorrow.

Client side I also reviced the use of sockets a bit I updated the function that creates and returns the socket to also take an dispatch to enable it to dispatch actions on receving data from the api for now the only data it's reciving is notifications but I plan to use this for more things (like user data on profiles for instance). I also added some func to visualize if there are notifications just by looking at the notifications icon (it changes color but I probably should add a animations as well). Part of this was also moving the func for getting notifications to the siteRoute component so that notifications can be fetched right away and not just when the notifications modal is mounted. I also added som func to fix a bug where the socket would be destroyed if the user refreshed the window (this still happens but now a new socket is opend if this hapens).

forgot to metion that i converted to the new version of listennotes yesterday, mainly becouse I hade an accited for a check to get top podcasts (forgot to add the typeof before a check if a certain value's a string) where toppodcasts where frequently fetched for about an hour before i notieced it and resulted in about 4000 requests and the limit is at 2000 for the old version and by chaning to the new one I instead get 10000/moth for free and get to start from scrath on the request count. The new version (which they controle the billing for themselfs) also do not allow sending to many request for the free version which is nice couse I won't have to worry about having to pay extra for the calls thats exeeds the limit (but I'm hopping I won't have any more acidents like that).