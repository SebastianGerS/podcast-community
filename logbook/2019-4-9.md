# finishing up recommend to user modal (with notifications) and most of ratings for episodes/podcasts

I have missed a few days of logbooking unfortunatly but I have been keeping bussy, unfortunatly creating a good rating system tok a bit longer then eccspected.
But on friday (5/4) I fist finished up func to enable reccomend episodes to user an now the notifications for these reccomendation shoes correct images as well.

Hten I started to work on making it possible to rate episodes, startings with creating a modal for this end enable it to be triggerd from the more options modal but only when the set item for the more options modal is an episode (you can only rate episodes). That part was kind of strait forward, I became a quit long function in the controller to enable this tought and i discoverd a few misstakes in the models for episodes and ratings during the way which I hade to correct. I also set up emitions to the episodes and podcasts that where effected (podcast ratings are based on the ratings of their episodes) I then made sure that theese emitions where translated into visualy apparent. I also created a few new icons (based of the icon of a star that I have hade since befor) to use for visualising which rating was beeing set.

I then started to work on gettings the current rating of the episode/podcast on loding the resource and I reworked it a couple of times and I ended up creating a new field on both the podcast and episode model in my database to store the current ratings which I recalucaled every time a new rating is made (or a rating is changed) and when now when I fetch episode(s) or podcast(s) from the listennotes api a also fetch (and create if the podcast/episode does not exists in my database yeat) the same episode(s)/podcast(s) from my own database and get the ratings and the return both my ratings and data listennotes data (unfortunaly I can't save the listennotes data with a exception of the id in my own data base). Also if a episode or podcast does not exist in my data base when voting it will be created (and newly created items always gets an avrageRating of 0 which then gets translated to just a dash in the front end).

I also ededup reworking when to create a new socket and how to open and close listeners on diffrent routes so now a socket is created emidietly when the site is loaded and start letening for updates on a specific episode if that episode is in the search result or if the user visits the podcasts individual page and thoes listeners are removed as soon as the user leves that particular page.

One thing I change now towards the end of the day is that when fetching an individual podcast (and displaying just that podcast) I also fetch all the episodes to get the ratings for all episodes it has thats in my data base, I then loop thrue them to return ratings for all of them. This might become a bit slow if a podcast hase a loot of episodes tought, while I think that the number of podcasts with more then a thousand episodes are few and I think it should not be a big problem until we go in to the tens of thousands but still meaby I should rewirte it to only get the latest episodes some howe, currently I'm fetching the episodes seperatly tought so meaby I should fetch the ratings there instead or meaby I should fetch the episodes toghter with the podcast so I know which to fetch ratings fore there.
It is possible to just paginate when fetching a single podcast and then get the next batch of episodes that bellong to it, and I have been thinking about switching to that method couse of a issue with episodes not being found for some podcasts, so I should probably do that.

I think that the only thing left now for ratings is to fix the styling somewhat so that the filling of the stars reflect the rating on the individual episodes/podcast and also som indication for the logged in user as to whter or not they personaly has rated an episode or not.