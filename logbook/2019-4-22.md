# refactoring follows online status and adding func to suport emitng listening_to

This weekend I have reworked how I'm hadeling online statuses, I created a sessions schema for the database, I use the sessions document to keep track of who is online, replacing the array in the socket function I used for that purpos privously. I still ned the array  to know when to update a users session tought (if users open serveral tabs multiple or log in from multiple devices I don't want to update the online to false until the last of these loses it's socket connection).
I also added alistening_to field to the Sessions schema which I set to update by emiting the episode that's ucrrently beeing listened to from the front end and then updating the sessions listening_to with the id, tought when I emit the updated session I replace the id with all of the episode data emited from the front end (this saves me from having to fetch the episode again from listennotes), but episodes beeing listened to by followers at the time of login is fetched from the listenotes api but atlest i'm doing a batch fetch so that all followers listenning_to's are fetched in just one call.

I also made some smaler modifications in the frontend, I incresed the frequency of with the pos (used visualze the progress of the episode timeline) of the current episode is updated this enables stoping and emiting a null value for listening_to with in 0.5 seconds of the end of the episode, without this the progress bar would sometimes not be stoped but just restart from the begning and if break point for stopping the episode was incresed to one second befor end of episode the progress bar would be stoped to early then it should at times.

I looked a bit at seting up migrations for my database models, partly becouse the way I have it set up now users gets a session when created ao creating a migration that adds sessions of preivously added users is realy a must, there have been several times where I realy should have added a migration prevously but I have just not preoritized that yet. I know thatfor a active site migrations would be absolutly nececary, but as this site is not actualy used yeat i'm going to skip it for now as well, this is also becouse I didn't find a good solution, the npm packages that I looked at did not suport using es6 imports and export, this couses a problem becouse i'm using es6 syntax for al my schema methods and will have to use them to do my migrations. But I will try to look more at this during the last two weeks.